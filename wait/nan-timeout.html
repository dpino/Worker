<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <script type="text/javascript" src="../browser-harness.js"></script>
</head>

<body>
  
</body>

<script type="text/javascript">
  window.addEventListener('load', function() {
    let w = Worker.create(`
        onmessage = function(e) {
            let ia = e.data[0];
            let ret = Atomics.wait(ia, 0, 0, NaN); // NaN => Infinity
            postMessage([ret]);
        }
    `);

    w.onmessage = function(e) {
        assert.sameValue(e.data[0], "ok");
        exitEventLoop(w);
    }

    let ia = new Int32Array(new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT));
    w.postMessage([ia]);

    // Ample time
    sleep(500).then(() => Atomics.wake(ia, 0));

    enterEventLoop();
  });
</script>

</html>
